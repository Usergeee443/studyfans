{% extends "base.html" %}

{% block title %}
	{% if lang == 'uz' %}Universitetlar - Study Fans{% elif lang == 'ru' %}Университеты - Study Fans{% elif lang == 'tr' %}Üniversiteler - Study Fans{% else %}Universities - Study Fans{% endif %}
{% endblock %}

{% block extra_css %}
<style>
	.small-swiper {
		width: 100%;
		height: auto;
	}
	
	.small-swiper .swiper-slide {
		width: auto;
	}
	
	.image-swiper {
		width: 100%;
		height: 300px;
		padding: 0 1.5rem;
	}
	
	.image-swiper .swiper-wrapper {
		border-radius: 1.5rem;
		overflow: hidden;
	}
	
	.image-swiper .swiper-slide {
		width: 100%;
		height: 100%;
		border-radius: 1.5rem;
		overflow: hidden;
	}
	
	.image-swiper .swiper-slide img {
		width: 100%;
		height: 100%;
		object-fit: cover;
		border-radius: 1.5rem;
	}
	
	.sticky-categories {
		position: sticky;
		top: 0;
		z-index: 30;
		background: white;
		backdrop-filter: blur(10px);
		border-bottom: 1px solid #e5e7eb;
	}

	/* Mobile University Cards - Smaller */
	@media (max-width: 768px) {
		.university-card {
			padding: 0.75rem !important;
		}

		.university-card .relative {
			height: 120px !important;
		}

		.university-card h3 {
			font-size: 0.875rem !important;
			line-height: 1.3 !important;
			margin-bottom: 0.5rem !important;
		}

		.university-card .text-xs {
			font-size: 0.625rem !important;
		}

		.university-card .text-xl {
			font-size: 1rem !important;
		}

		.university-card a {
			padding: 0.5rem 1rem !important;
			font-size: 0.75rem !important;
		}

		.university-card .p-5 {
			padding: 0.75rem !important;
		}
	}
</style>
{% endblock %}

{% block content %}

<div class="page-container" style="margin-top: 0; padding-top: 0;">
<!-- Top Section with Title, Search and Filter -->
<section class="pt-6 pb-6 bg-white">
	<div class="max-w-7xl mx-auto px-6">
		<!-- Mobile Layout: Title on top, Search/Filter below -->
		<!-- Desktop Layout: Title and Search/Filter side by side -->
		<div class="flex flex-col md:flex-row md:items-start md:justify-between md:gap-4 mb-4 md:mb-6">
			<!-- Title Section -->
			<div class="flex-1 mb-4 md:mb-0">
				<h1 class="text-2xl font-medium text-gray-900 mb-1" style="font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif; letter-spacing: -0.02em;">
					{% if lang == 'uz' %}Universitetlar{% elif lang == 'ru' %}Университеты{% elif lang == 'tr' %}Üniversiteler{% else %}Universities{% endif %}
				</h1>
				<!-- Description - Hidden on Mobile -->
				<p class="hidden md:block text-sm text-gray-500 font-normal mt-0.5" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;">
					{% if lang == 'uz' %}60+ universitet Turkiya, Kipr, Gruziya va Malayziyadan{% elif lang == 'ru' %}60+ университетов из Турции, Кипра, Грузии и Малайзии{% elif lang == 'tr' %}Türkiye, Kıbrıs, Gürcistan ve Malezya'dan 60+ üniversite{% else %}60+ universities from Turkey, Cyprus, Georgia and Malaysia{% endif %}
				</p>
			</div>
			
			<!-- Search and Filter Bar - Mobile: Below Title, Desktop: Side by side with Title -->
			<div class="flex items-center gap-3 md:flex-shrink-0 md:w-auto">
				<!-- Search Input - Full Border Radius -->
				<div class="flex-1 md:flex-shrink-0 md:w-64 relative">
					<input type="text" id="searchInput" placeholder="{% if lang == 'uz' %}Qidirish...{% elif lang == 'ru' %}Поиск...{% elif lang == 'tr' %}Ara...{% else %}Search...{% endif %}" class="w-full px-4 py-2.5 pl-11 bg-gray-50 border border-gray-200 rounded-full text-sm text-gray-900 font-normal focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;">
					<img src="/static/search-normal.svg" alt="Search" class="absolute left-3.5 top-1/2 transform -translate-y-1/2 w-4 h-4">
				</div>
				
				<!-- Filter Button -->
				<button id="filterBtn" class="px-4 py-2.5 bg-gray-50 border border-gray-200 rounded-full text-sm text-gray-900 font-normal hover:bg-gray-100 transition-all flex items-center gap-2 flex-shrink-0" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;">
					<img src="/static/filter-search.svg" alt="Filter" class="w-4 h-4">
					<span class="hidden md:inline">{% if lang == 'uz' %}Filter{% elif lang == 'ru' %}Фильтр{% elif lang == 'tr' %}Filtre{% else %}Filter{% endif %}</span>
				</button>
			</div>
		</div>
		
		<!-- Filter Panel (Hidden by default) -->
		<div id="filterPanel" class="hidden mt-4 p-4 bg-gray-50 rounded-2xl border border-gray-200">
			<div class="grid grid-cols-1 md:grid-cols-3 gap-4">
				<select id="country" class="px-4 py-2.5 bg-white border border-gray-200 rounded-xl text-sm text-gray-900 font-normal focus:outline-none focus:ring-2 focus:ring-blue-500">
					<option value="">{% if lang == 'uz' %}Davlat{% elif lang == 'ru' %}Страна{% elif lang == 'tr' %}Ülke{% else %}Country{% endif %}</option>
					<option value="Turkey">{% if lang == 'uz' %}Turkiya{% elif lang == 'ru' %}Турция{% elif lang == 'tr' %}Türkiye{% else %}Turkey{% endif %}</option>
					<option value="Cyprus">{% if lang == 'uz' %}Kipr{% elif lang == 'ru' %}Кипр{% elif lang == 'tr' %}Kıbrıs{% else %}Cyprus{% endif %}</option>
					<option value="Georgia">{% if lang == 'uz' %}Gruziya{% elif lang == 'ru' %}Грузия{% elif lang == 'tr' %}Gürcistan{% else %}Georgia{% endif %}</option>
					<option value="Malaysia">{% if lang == 'uz' %}Malayziya{% elif lang == 'ru' %}Малайзия{% elif lang == 'tr' %}Malezya{% else %}Malaysia{% endif %}</option>
				</select>
				
				<select id="language" class="px-4 py-2.5 bg-white border border-gray-200 rounded-xl text-sm text-gray-900 font-normal focus:outline-none focus:ring-2 focus:ring-blue-500">
					<option value="">{% if lang == 'uz' %}Til{% elif lang == 'ru' %}Язык{% elif lang == 'tr' %}Dil{% else %}Language{% endif %}</option>
					<option value="English">{% if lang == 'uz' %}Ingliz{% elif lang == 'ru' %}Английский{% elif lang == 'tr' %}İngilizce{% else %}English{% endif %}</option>
					<option value="Turkish">{% if lang == 'uz' %}Turk{% elif lang == 'ru' %}Турецкий{% elif lang == 'tr' %}Türkçe{% else %}Turkish{% endif %}</option>
				</select>
				
				<select id="price" class="px-4 py-2.5 bg-white border border-gray-200 rounded-xl text-sm text-gray-900 font-normal focus:outline-none focus:ring-2 focus:ring-blue-500">
					<option value="">{% if lang == 'uz' %}Narx{% elif lang == 'ru' %}Цена{% elif lang == 'tr' %}Fiyat{% else %}Price{% endif %}</option>
					<option value="1500-3000">1500$ - 3000$</option>
					<option value="3000-5000">3000$ - 5000$</option>
					<option value="5000+">5000$+</option>
				</select>
			</div>
		</div>
	</div>
</section>

<!-- Image Swiper Section -->
<section class="bg-white pt-2 pb-4">
	<div class="swiper image-swiper">
		<div class="swiper-wrapper">
			<div class="swiper-slide">
				<img src="/static/images/turkey-1.jpg" alt="Turkey" onerror="this.src='https://images.pexels.com/photos/256490/pexels-photo-256490.jpeg';">
			</div>
			<div class="swiper-slide">
				<img src="/static/images/turkey-2.jpg" alt="Turkey" onerror="this.src='https://images.pexels.com/photos/159514/yale-university-landscape-universities-schools-159514.jpeg';">
			</div>
			<div class="swiper-slide">
				<img src="/static/images/turkey-3.jpg" alt="Turkey" onerror="this.src='https://images.pexels.com/photos/185764/pexels-photo-185764.jpeg';">
			</div>
			<div class="swiper-slide">
				<img src="/static/images/turkey-4.jpg" alt="Turkey" onerror="this.src='https://images.pexels.com/photos/3769697/pexels-photo-3769697.jpeg';">
			</div>
		</div>
		<div class="swiper-pagination"></div>
	</div>
</section>

<!-- Sticky Categories Section -->
<section class="sticky-categories py-4 bg-white">
	<div class="max-w-7xl mx-auto px-6">
		<div class="swiper small-swiper">
			<div class="swiper-wrapper">
				<div class="swiper-slide">
					<button class="category-btn px-4 py-2 bg-blue-50 text-blue-600 rounded-full text-xs font-normal text-center transition-all hover:bg-blue-100 active" data-country="" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;">
						{% if lang == 'uz' %}Barcha{% elif lang == 'ru' %}Все{% elif lang == 'tr' %}Tümü{% else %}All{% endif %}
					</button>
				</div>
				<div class="swiper-slide">
					<button class="category-btn px-4 py-2 bg-gray-50 text-gray-600 rounded-full text-xs font-normal text-center transition-all hover:bg-gray-100" data-country="Turkey" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;">
						{% if lang == 'uz' %}Turkiya{% elif lang == 'ru' %}Турция{% elif lang == 'tr' %}Türkiye{% else %}Turkey{% endif %}
					</button>
				</div>
				<div class="swiper-slide">
					<button class="category-btn px-4 py-2 bg-gray-50 text-gray-600 rounded-full text-xs font-normal text-center transition-all hover:bg-gray-100" data-country="Cyprus" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;">
						{% if lang == 'uz' %}Kipr{% elif lang == 'ru' %}Кипр{% elif lang == 'tr' %}Kıbrıs{% else %}Cyprus{% endif %}
					</button>
				</div>
				<div class="swiper-slide">
					<button class="category-btn px-4 py-2 bg-gray-50 text-gray-600 rounded-full text-xs font-normal text-center transition-all hover:bg-gray-100" data-country="Georgia" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;">
						{% if lang == 'uz' %}Gruziya{% elif lang == 'ru' %}Грузия{% elif lang == 'tr' %}Gürcistan{% else %}Georgia{% endif %}
					</button>
				</div>
				<div class="swiper-slide">
					<button class="category-btn px-4 py-2 bg-gray-50 text-gray-600 rounded-full text-xs font-normal text-center transition-all hover:bg-gray-100" data-country="Malaysia" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;">
						{% if lang == 'uz' %}Malayziya{% elif lang == 'ru' %}Малайзия{% elif lang == 'tr' %}Malezya{% else %}Malaysia{% endif %}
					</button>
				</div>
			</div>
		</div>
	</div>
</section>

<!-- University Cards Section -->
<section class="py-8 bg-white">
	<div class="max-w-7xl mx-auto px-6">
		<div class="mb-6">
			<p class="text-sm text-gray-600 font-normal" id="resultsCount" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;">
				<span id="countNumber">{{ universities|length }}</span> {% if lang == 'uz' %}universitet topildi{% elif lang == 'ru' %}университетов найдено{% elif lang == 'tr' %}üniversite bulundu{% else %}universities found{% endif %}
			</p>
		</div>
		
		<div id="universitiesGrid" class="grid grid-cols-2 md:grid-cols-2 lg:grid-cols-3 gap-3 md:gap-6">
			{% for university in universities %}
			<div class="university-card bg-white rounded-3xl overflow-hidden border border-gray-200 hover:shadow-lg transition-all duration-200 group" data-country="{% if lang == 'uz' %}{{ university.country_uz }}{% elif lang == 'ru' %}{{ university.country_ru }}{% elif lang == 'tr' %}{{ university.country_tr }}{% else %}{{ university.country_en }}{% endif %}">
				<div class="relative h-52 bg-gradient-to-br from-gray-50 to-gray-100 overflow-hidden">
					{% if university.logo_url %}
					<img src="/static/{{ university.logo_url }}" alt="{{ university.name_uz }}" class="w-full h-full object-contain p-4 group-hover:scale-105 transition-transform duration-300">
					{% else %}
					<div class="w-full h-full flex items-center justify-center">
						<span class="text-6xl text-gray-300 font-light">{{ university.name_uz[0] if university.name_uz else 'U' }}</span>
					</div>
					{% endif %}
					<div class="absolute top-3 right-3">
						<span class="px-3 py-1.5 bg-white/95 backdrop-blur-sm text-gray-900 rounded-full text-xs font-medium shadow-sm">
							{% if lang == 'uz' %}{{ university.country_uz }}{% elif lang == 'ru' %}{{ university.country_ru }}{% elif lang == 'tr' %}{{ university.country_tr }}{% else %}{{ university.country_en }}{% endif %}
						</span>
					</div>
				</div>
				
				<div class="p-5">
					<h3 class="text-lg font-medium text-gray-900 mb-2.5 leading-tight" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;">
						{% if lang == 'uz' %}{{ university.name_uz }}{% elif lang == 'ru' %}{{ university.name_ru }}{% elif lang == 'tr' %}{{ university.name_tr }}{% else %}{{ university.name_en }}{% endif %}
					</h3>
					<div class="flex items-center gap-2 text-gray-600 mb-3">
						<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="text-gray-400">
							<path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
							<circle cx="12" cy="10" r="3"/>
						</svg>
						<p class="text-xs font-normal text-gray-500" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;">
							{% if lang == 'uz' %}{{ university.city_uz }}{% elif lang == 'ru' %}{{ university.city_ru }}{% elif lang == 'tr' %}{{ university.city_tr }}{% else %}{{ university.city_en }}{% endif %}
						</p>
					</div>
					
					<div class="flex flex-wrap gap-2 mb-4">
						{% if university.language %}
						<span class="px-2.5 py-1 bg-blue-50 text-blue-700 rounded-lg text-xs font-medium" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;">
							{{ university.language }}
						</span>
						{% endif %}
						{% if university.grant_available %}
						<span class="px-2.5 py-1 bg-yellow-50 text-yellow-700 rounded-lg text-xs font-medium" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;">
							{% if lang == 'uz' %}Grant{% elif lang == 'ru' %}Грант{% elif lang == 'tr' %}Burs{% else %}Grant{% endif %}
						</span>
						{% endif %}
					</div>
					
					{% if university.tuition_fee_min and university.tuition_fee_max %}
					<div class="mb-4 pb-4 border-b border-gray-100">
						<p class="text-xl font-semibold text-gray-900 mb-0.5" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;">
							{{ university.tuition_fee_min }}$ - {{ university.tuition_fee_max }}$
						</p>
						<p class="text-xs text-gray-500 font-normal" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;">
							{% if lang == 'uz' %}yillik{% elif lang == 'ru' %}в год{% elif lang == 'tr' %}yıllık{% else %}per year{% endif %}
						</p>
					</div>
					{% endif %}
					
					<a href="/university/{{ university.id }}?lang={{ lang }}" class="block w-full px-5 py-2.5 bg-gray-900 text-white rounded-full hover:bg-gray-800 transition-all duration-300 text-center text-sm font-medium" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;">
						{% if lang == 'uz' %}Batafsil{% elif lang == 'ru' %}Подробнее{% elif lang == 'tr' %}Detaylar{% else %}Details{% endif %}
					</a>
				</div>
			</div>
			{% endfor %}
		</div>
		
		<div id="emptyState" class="hidden text-center py-16">
			<svg class="mx-auto w-20 h-20 text-gray-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
				<path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
			</svg>
			<p class="text-lg text-gray-600 font-normal mb-2" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;">
				{% if lang == 'uz' %}Hech narsa topilmadi{% elif lang == 'ru' %}Ничего не найдено{% elif lang == 'tr' %}Hiçbir şey bulunamadı{% else %}Nothing found{% endif %}
			</p>
			<p class="text-sm text-gray-500 font-normal" style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;">
				{% if lang == 'uz' %}Boshqa filterlarni sinab ko'ring{% elif lang == 'ru' %}Попробуйте другие фильтры{% elif lang == 'tr' %}Başka filtreler deneyin{% else %}Try other filters{% endif %}
			</p>
		</div>
	</div>
</section>

</div>

<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<script>
// Initialize Image Swiper
const imageSwiper = new Swiper('.image-swiper', {
	slidesPerView: 1,
	spaceBetween: 0,
	loop: true,
	autoplay: {
		delay: 3000,
		disableOnInteraction: false,
	},
	pagination: {
		el: '.swiper-pagination',
		clickable: true,
	},
});

// Initialize Small Swiper for Categories
const smallSwiper = new Swiper('.small-swiper', {
	slidesPerView: 'auto',
	spaceBetween: 8,
	freeMode: true,
});

// Filter Panel Toggle
document.getElementById('filterBtn').addEventListener('click', function() {
	const panel = document.getElementById('filterPanel');
	panel.classList.toggle('hidden');
});

// Search and Filter Function
function performSearch() {
	const searchTerm = document.getElementById('searchInput').value.toLowerCase();
	const country = document.getElementById('country').value;
	const language = document.getElementById('language').value;
	const price = document.getElementById('price').value;
	
	// Get active category button country
	const activeCategory = document.querySelector('.category-btn.active');
	const categoryCountry = activeCategory ? activeCategory.getAttribute('data-country') : '';
	
	// Use category country if no filter country selected
	const filterCountry = country || categoryCountry;
	
	const cards = document.querySelectorAll('.university-card');
	let visibleCount = 0;
	
	cards.forEach(card => {
		const name = card.querySelector('h3').textContent.toLowerCase();
		const cardCountry = card.getAttribute('data-country');
		let matches = true;
		
		if (searchTerm && !name.includes(searchTerm)) {
			matches = false;
		}
		
		if (filterCountry && cardCountry !== filterCountry) {
			matches = false;
		}
		
		if (matches) {
			card.style.display = 'block';
			visibleCount++;
		} else {
			card.style.display = 'none';
		}
	});
	
	document.getElementById('countNumber').textContent = visibleCount;
	
	const emptyState = document.getElementById('emptyState');
	if (visibleCount === 0) {
		emptyState.classList.remove('hidden');
	} else {
		emptyState.classList.add('hidden');
	}
}

document.getElementById('searchInput').addEventListener('input', performSearch);
document.getElementById('country').addEventListener('change', performSearch);
document.getElementById('language').addEventListener('change', performSearch);
document.getElementById('price').addEventListener('change', performSearch);

// Category Buttons Functionality
document.querySelectorAll('.category-btn').forEach(btn => {
	btn.addEventListener('click', function() {
		// Remove active class from all buttons
		document.querySelectorAll('.category-btn').forEach(b => {
			b.classList.remove('active', 'bg-blue-50', 'text-blue-600');
			b.classList.add('bg-gray-50', 'text-gray-600');
		});
		
		// Add active class to clicked button
		this.classList.add('active', 'bg-blue-50', 'text-blue-600');
		this.classList.remove('bg-gray-50', 'text-gray-600');
		
		// Reset filter dropdown
		document.getElementById('country').value = '';
		
		// Perform search with category filter
		performSearch();
	});
});
</script>

{% endblock %}
